---
layout: post
title:  "2018-07-06 TIL(Docker)"
date:   2018-07-06 14:20:00 +0900
categories: TIL
---

**Docker container에 ubuntu 17.10 설치하기**

```
$ docker run --rm -it ubuntu:17:10 /bin/bash
```

- --rm : 프로세스 종료 후 컨테이너 삭제
- -it : 입력을 받도록 함
- /bin/bash : bash  실행


**업데이트 실행**

```
# apt update
```

**업그레이드 가능한 목록을 의존성에 맞게 업그레이드**

```
# apt dist-upgrade
```

**zsh 설치**

```
# apt install zsh
```

여기서 exit를 눌러서 나가면 이미지로 만들어진 ubuntu를 제외하고 컨테이너에서 실행되었던 업데이트, 업그레이드를 포함하여 zsh까지 모두 사라지게 된다.

따라서 위와 같은 필수적인 내용을 포함하여 이미지를 만들어야한다. Dockerfile을 생성해주어야 한다.

```docker
FROM			ubuntu:17.10
MAINTAINER	chpark816@gmail.com

RUN				apt -y update && apt -y dist-upgrade

RUN				apt -y install zsh
```

쉘로 돌아와서 만들어 놓은 Dockerfile로 image build를 해본다.

```
$ docker build -t ec2-deploy -f Dockerfile .
```

4개의 layer를 확인할 수 있다.

이와 같은 방법으로 pyenv, python, pipenv, language 설정, Pipfile복사하는 Dockerfile을 설치해준다.

전체 Dockerfile은 다음과 같다.

```docker
FROM        ubuntu:17.10
MAINTAINER  pchpch0070@gmail.com

# update, upgrade
RUN         apt -y update && apt -y dist-upgrade

# zsh
RUN         apt -y install zsh curl git
RUN         curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh | bash
RUN         chsh -s /usr/bin/zsh

# pyenv
RUN         curl -L https://github.com/pyenv/pyenv-installer/raw/master/bin/pyenv-installer | bash
RUN         apt -y install make build-essential libssl-dev zlib1g-dev libbz2-dev \
                   libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev libncursesw5-dev \
                   xz-utils tk-dev libffi-dev
# pyenv settings
RUN         echo 'export PATH="/root/.pyenv/bin:$PATH"' >> ~/.zshrc
RUN         echo 'eval "$(pyenv init -)"' >> ~/.zshrc
RUN         echo 'eval "$(pyenv virtualenv-init -)"' >> ~/.zshrc

# install python, apply pyenv settings
ENV         PATH /root/.pyenv/bin:$PATH
RUN         eval "$(pyenv init -)"
RUN         eval "$(pyenv virtualenv-init -)"
RUN         pyenv install 3.6.5

# pipenv
RUN         apt -y install software-properties-common python-software-properties
RUN         add-apt-repository -y ppa:pypa/ppa
RUN         apt -y update
RUN         apt -y install pipenv

# Language
ENV         LANG    C.UTF-8
ENV         LC_ALL  C.UTF-8

RUN         apt -y install vim

# Copy Pipfile
RUN         mkdir /srv/project
COPY        ./Pipfile       /srv/project
WORKDIR     /srv/project
RUN         pipenv install --skip-lock
```




